# Copyright (c) Microsoft Corporation.
# SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception

import os
import site
site.addsitedir("@STL_TEST_UTILS_DIR@")
site.addsitedir(os.path.join("@LIBCXX_SOURCE_DIR@", "utils"))
import stl.test.config
import stl.test.features
import stl.test.file_parsing
import stl.test.format
import stl.test.params

config.name           = 'tr1'
config.suffixes       = ['test[.]cpp$']
config.test_exec_root = "@TR1_TEST_OUTPUT_DIR@"
config.test_format    = stl.test.format.STLTestFormat()

lit_config.expected_results = getattr(lit_config, 'expected_results', dict())
lit_config.include_dirs     = getattr(lit_config, 'include_dirs', dict())
lit_config.library_dirs     = getattr(lit_config, 'library_dirs', dict())
lit_config.test_subdirs     = getattr(lit_config, 'test_subdirs', dict())

lit_config.expected_results[config.name] = stl.test.file_parsing.parse_result_file('@TR1_EXPECTED_RESULTS@')
lit_config.include_dirs[config.name]     = \
    ['@STL_TESTED_HEADERS_DIR@', '@STL_SOURCE_DIR@/tests/tr1/include', '@STL_SOURCE_DIR@/tests/std/include']
lit_config.library_dirs[config.name]     = ['@CMAKE_LIBRARY_OUTPUT_DIRECTORY@', '@TOOLSET_LIB@']
lit_config.test_subdirs[config.name]     = \
    [os.path.normpath(os.path.join('@TR1_TEST_SUBDIRS_ROOT@', path)) for \
     path in stl.test.file_parsing.parse_commented_file('@TR1_TEST_SUBDIRS_FILE@')]

lit_config.cxx_runtime = '@CMAKE_RUNTIME_OUTPUT_DIRECTORY@'
lit_config.target_arch = '@VCLIBS_TARGET_ARCHITECTURE@'

# Add parameters and features to the config
stl.test.config.configure(
    stl.test.params.getDefaultParameters(config, lit_config),
    stl.test.features.getDefaultFeatures(config, lit_config),
    config,
    lit_config
)
